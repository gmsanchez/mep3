#VRML_SIM R2022a utf8
# template language: javascript

PROTO Zamenjivac [
  hiddenField SFVec3f anchor_L_mid    -0.07655  0.0248 0.20104
  hiddenField SFVec3f anchor_connector 0.0667 -0.0009 0.1525
  hiddenField SFVec3f anchor_gripper   0.0667 -0.0009 0.1425
  hiddenField SFRotation rotation_positive 1 0 0 1.57079
  hiddenField SFRotation rotation_negative 1 0 0 -1.57079
  hiddenField SFRotation rotation_zero 1 0 0 0
  hiddenField SFVec3f x_axis 1 0 0
  hiddenField SFVec3f y_axis 0 1 0
  hiddenField SFFloat hand_mass 0.05
  hiddenField SFVec3f gripper_inset 0 0 0.003
  hiddenField SFFloat resistance_position 0.015
]
{
%<
  var anchor_gripper_inset;
  var anchor_connector_inset;
  anchor_gripper_inset = fields.anchor_gripper.value;
  anchor_gripper_inset.x -= fields.gripper_inset.value.x;
  anchor_gripper_inset.y -= fields.gripper_inset.value.y;
  anchor_gripper_inset.z -= fields.gripper_inset.value.z;
  anchor_connector_inset = fields.anchor_gripper.value;
  anchor_connector_inset.x -= fields.gripper_inset.value.x;
  anchor_connector_inset.y -= fields.gripper_inset.value.y;
  anchor_connector_inset.z -= fields.gripper_inset.value.z;
  
  var anchor;
  var axis;
  var rotation;
  var position;
  var min_position;
  var max_position;
  
    min_position = -1.57079;
    max_position = 0.349066; 
    position = 0;
    anchor = fields.anchor_L_mid.value;
    axis = fields.y_axis.value;
    axis.x = -axis.x;
    axis.y = -axis.y;
    axis.z = -axis.z;
    rotation = fields.rotation_zero.value;

>%
Transform {
	children [
		HingeJoint {
			jointParameters HingeJointParameters {
				axis %<= axis.x >% %<= axis.y >% %<= axis.z >%
				anchor %<= anchor.x >% %<= anchor.y >% %<= anchor.z >%
				position %<= position >%
			}
			device [
				RotationalMotor {
					name "hand_zamenjivac"
					minPosition %<= min_position >%
					maxPosition %<= max_position >%
				}
				PositionSensor {
					name "hand_zamenjivac_sensor"
				}
			]
			endPoint Solid {
				name "hand_zamenjivac"
				children [
					Shape {
						appearance PBRAppearance {
							baseColor 0.4 0.4 0.4
							metalness 0
							roughness 1
						}
						geometry Mesh {
							url ["assets/meshes/RobotFlorijan/Zamenjivac.obj"]
						}
					}
					Connector {
						translation -0.09 0 0.123
						rotation 0 0 1 3.14159
						name "hand_L_statuette_connector"
						type "active"
						numberOfRotations 0
						distanceTolerance 0.02
						axisTolerance 0.5
					}
					Connector {
						translation -0.0821 0 0.1474
						rotation 0 0 1 0
						name "hand_L_replica_connector"
						type "active"
						isLocked TRUE
						numberOfRotations 0
					}
				]
				boundingObject Transform{
					translation %<= fields.anchor_L_mid.value.x-0.008 >% 0 %<= fields.anchor_L_mid.value.z-0.052 >%
					children [
						Box {
							size 0.013 0.073 0.09
						}	
					]
				}
				physics Physics {
					density -1
					mass IS hand_mass
				}
			}
		}
	]
}
}
